# MONKi Biz Operation

## 프로젝트 개요
- **이름**: MONKi Biz Operation
- **정식 명칭**: 사업운영본부 통합 업무 플랫폼
- **기술 스택**: Cloudflare D1 + Hono + TypeScript + TailwindCSS
- **배포 플랫폼**: Cloudflare Pages

## URLs
- **프로덕션**: https://monki-biz-op.pages.dev
- **GitHub**: https://github.com/mk-jeon/monki-biz-op

## 50개 컬럼 확장 완료 (Phase 2)
### 데이터 구조
- **기본 정보 (8개)**: 생년월일, 이메일, 사업자번호, 대표자명, 도로명주소, 상세주소, 지역, 지역구분
- **금융 정보 (9개)**: 은행명, 계좌번호, 예금주, 계약유형, 출금일, 월렌탈료, 보증금, 계약일, 계약번호
- **H/W POS (7개)**: POS 대리점, 제조사, 모델명, 프로그램, ASP ID/PW/URL
- **H/W 테이블오더 (6개)**: 테이블오더 수량, 거치대(일반/평판/확장), 충전기, 배터리
- **H/W 네트워크 (4개)**: 공유기, 키오스크, 주방프린터, 호출벨
- **관리 정보 (2개)**: CRM 서비스, AI매출업 서비스

### 데이터 이관 파이프라인
- **상담 → 계약 → 설치 → 운영 → 가맹점**
- 각 단계에서 50개 컬럼 완전 복사
- 데이터 유실 없음

## 운영등재 승인 로직 (Phase 2)
### Gatekeeper 시스템
승인 시 필수 4가지 조건 검증:
1. ✅ 계약서 작성 확인
2. ✅ 설치확인서 확인
3. ✅ 설치사진 확인
4. ✅ 구글 드라이브 URL 입력

### 5-Tab UI 구조 (운영등재)
- **Tab 1 - 기본**: 고객명, 전화번호, 생년월일, 이메일, 사업자번호, 대표자명, 주소, 지역, 상태
- **Tab 2 - 금융**: 은행명, 계좌번호, 예금주, 계약유형, 출금일, 월렌탈료, 보증금, 계약일, 계약번호
- **Tab 3 - H/W**: POS 정보 (7개), 테이블오더 & 거치대 (6개), 네트워크 & 기타 (4개)
- **Tab 4 - 관리**: CRM 서비스, AI 매출 분석 서비스, 메모
- **Tab 5 - 증빙**: 체크박스 3개 + 구글 드라이브 URL

### 승인 후 자동 이관
- 승인 성공 시 Franchises 테이블로 50개 컬럼 완전 복사
- 리스트에 [승인(✓)] 버튼 표시
- 미충족 조건 시 상세 에러 메시지 표시

## 완료된 기능
### Phase 3 (2026-02-03) - 긴급 버그 수정
✅ **설치현황 페이지 진입 불가 해결**: IIFE 스코프 문제 완전 해결, 전역 함수 선언
✅ **대시보드 집계 정상화**: 진행 중 건수만 표시 (completed/cancelled 제외)
✅ **계약현황 필드 변경**: '유입경로' → '등록사유' 변경
✅ **가맹점현황 데이터 연동**: 옵셔널 체이닝 추가로 안정성 강화
✅ **이관 후 리다이렉트 제거**: 설치 이관 후 제자리 새로고침
✅ **운영등재 카운트**: operationCount ID 추가로 대시보드 표시 정상화

### Phase 2 (2026-02-02)
✅ 50개 컬럼 스키마 확장 (Consultations, Contracts, Installations, Operations, Franchises)
✅ 5-Tab UI 전면 개편 (운영등재)
✅ 운영등재 승인 프로세스 구현
✅ 설치현황 저장 버그 수정
✅ 데이터 이관 파이프라인 완성

### Phase 1
✅ 로그인/인증 시스템
✅ 대시보드 (4개 현황 카드)
✅ 공지사항 게시판
✅ 상담현황 (리스트/칸반 + 드래그앤드롭)
✅ 계약현황 (리스트/칸반 + 설치 이관)
✅ 설치현황 (리스트/칸반 + 재방문 관리 + 운영 이관)
✅ 항목 관리 시스템
✅ 사용자 관리
✅ 권한 기반 메뉴 시스템

## 알려진 이슈
⚠️ **계약현황**: '등록사유' 드롭다운이 비어있을 수 있음 → **해결**: 항목관리에서 'registration_reason' 카테고리 수동 추가 필요
  - 카테고리명: `registration_reason`
  - 라벨: `등록사유`
  - 페이지: `contract`
  - 값 예시: 신규 개설, 인수 인계, 재계약, 업그레이드

## 다음 단계 (Phase 4)
- 5-Tab UI 확장 (Consultation, Contract 페이지)
- 가맹점현황 고도화
- 정산 전용 디자인
- 재고 대시보드

## 배포 정보
- **프로덕션**: https://monki-biz-op.pages.dev
- **최신 배포**: https://7c352d69.monki-biz-op.pages.dev
- **최근 업데이트**: 2026-02-03 (Phase 3 긴급 버그 수정)
- **커밋**: 420e383
- **데이터베이스**: Cloudflare D1 (SQLite)

## 로그인 정보
- **마스터 계정**: master / Master1234!
