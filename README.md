# MONKi Biz Operation

## 프로젝트 개요
- **이름**: MONKi Biz Operation
- **정식 명칭**: 사업운영본부 통합 업무 플랫폼
- **목표**: 통합 업무 플랫폼 구축
- **주요 기능**: 
  - 사용자 인증 및 권한 관리
  - 대시보드 (상담현황, 계약현황, 설치현황, 운영등재)
  - 공지사항 게시판
  - 권한 기반 메뉴 시스템
  - **항목 관리 시스템** (드롭다운 항목 통합 관리)
  - 반응형 UI/UX

## URLs
- **프로덕션**: https://monki-biz-op.pages.dev
- **GitHub**: https://github.com/mk-jeon/monki-biz-op

## 로그인 정보
### 마스터 계정
- **아이디**: master
- **비밀번호**: Master1234!
- **권한**: 모든 권한 (master)

## 데이터 아키텍처
- **데이터 모델**:
  - Users (사용자)
  - Sessions (세션)
  - Consultations (상담현황)
  - Contracts (계약현황)
  - Installations (설치현황)
  - Operations (운영등재)
  - Notices (공지사항)
  - Departments (부서)
  - **ItemCategories (항목 카테고리)** ⭐ NEW
  - **ItemValues (항목 값)** ⭐ NEW
- **스토리지 서비스**: Cloudflare D1 (SQLite)
- **인증 방식**: 세션 기반 인증 (쿠키)

## 현재 구현된 기능

### ✅ 완료된 기능

1. **로그인 시스템**
   - 사용자 인증 (아이디/비밀번호)
   - 세션 관리 (24시간 유지)
   - 로그아웃 기능

2. **대시보드**
   - 4개 주요 현황 카드 (상담/계약/설치/운영)
   - **실시간 진행 건수 표시** (API 연동)
   - 상담현황 건수 자동 로드
   - 카드 클릭 시 상세 페이지 이동

3. **공지사항 게시판** ✅
   - 목록 조회 (페이지네이션)
   - **분류 기능** (업데이트/정보공유/일반)
   - **중요 공지 표시**
   - **연관채널 다중 선택** (사장님사이트, 테이블오더App, OKPOS, EasyPOS, 엑스퍼트포스, 유니온)
   - 상단 고정 기능
   - 작성/수정/삭제 (권한 기반)
   - 조회수 표시
   - 내용 미리보기
   - 반응형 에디터
   - **채널별 색상 뱃지**

4. **상담현황** ⭐
   - **리스트 모드**
     - 테이블 형태로 전체 상담 목록 조회
     - **컬럼 정렬 기능** (헤더 클릭 시 오름차순 → 내림차순 → 기본순)
     - 정렬 가능: ID, 상태, 고객명, 전화번호, 유입경로, 등록일, 등록자
     - 기본 정렬: 상태 우선순위 + 최신순
     - 행 클릭 시 상세 모달
     - 수정/삭제 버튼
   - **칸반 모드** 🎯
     - 5개 컬럼: 상담대기 / 상담중 / 보류 / 계약확정 / 취소
     - **드래그앤드롭으로 상태 변경**
     - 카드 형태로 주요 정보 표시
     - 드롭존 시각적 피드백
     - 각 컬럼별 건수 표시
   - **신규 등록**
     - 고객명 (선택), 전화번호 (필수)
     - **유입경로 (드롭다운 - 항목관리 API 연동)** ⭐
     - 요청사항/메모 (넓은 텍스트 영역)
     - 진행 상태 선택 (수정 시)
     - 세부 옵션: 방문상담 O/X, 견적서 O/X
     - **마스터 계정: 드롭다운 하단 '항목 관리' 버튼** 👑
   - **엑셀 기능**
     - 빈양식 다운로드 (CSV)
     - 일괄 업로드 (성공/실패 건수 표시)
   - **모드 전환**: 리스트 ↔ 칸반 버튼으로 전환

5. **계약현황** ⭐
   - **리스트 모드**
     - 테이블 형태로 전체 계약 목록 조회
     - **컬럼 정렬 기능** (헤더 클릭 시 오름차순 → 내림차순 → 기본순)
     - 정렬 가능: ID, 상태, 고객명, 전화번호, 유입경로, 등록일, 등록자
     - 기본 정렬: 상태 우선순위 + 최신순
     - 행 클릭 시 상세 모달
     - 수정/삭제 버튼
   - **칸반 모드** 🎯
     - 6개 컬럼: 계약대기 / 계약 중 / 서명대기 / 계약보류 / 계약완료 / 취소
     - **드래그앤드롭으로 상태 변경**
     - 카드 형태로 주요 정보 표시 (선설치 배지 포함)
     - 드롭존 시각적 피드백
     - 각 컬럼별 건수 표시
   - **신규 등록**
     - 고객명 (선택), 전화번호 (필수)
     - **계약유형 (드롭다운 - 항목관리 API 연동)** ⭐
     - 진행 상태
     - 세부 옵션: 선 설치진행 O/X
     - 메모
     - **마스터 계정: 드롭다운 하단 '항목 관리' 버튼** 👑
   - **모드 전환**: 리스트 ↔ 칸반 버튼으로 전환
   - **설치 이관**: 계약완료 건을 설치현황으로 이관

6. **설치현황** ⭐
   - **리스트 모드**
     - 테이블 형태로 전체 설치 목록 조회
     - **컬럼 정렬 기능** (헤더 클릭 시 오름차순 → 내림차순 → 기본순)
     - 정렬 가능: ID, 상태, 고객명, 전화번호, 등록일, 등록자
     - 기본 정렬: 상태 우선순위 + 최신순
     - 플래그 표시: 계약서 미진행
     - 체크리스트 아이콘: 설치확인서, 설치사진, 드라이브 업로드
     - 행 클릭 시 상세 모달
     - 수정/삭제 버튼
   - **칸반 모드** 🎯
     - 5개 컬럼: 설치대기 / 설치 중 / 설치보류 / 설치완료 / 설치취소
     - **드래그앤드롭으로 상태 변경**
     - 카드 형태로 주요 정보 표시
     - 선설치 배지, 체크리스트 아이콘, 재방문 정보
     - 각 컬럼별 건수 표시
   - **신규 등록**
     - **설치유형 (드롭다운 - 항목관리 API 연동)** ⭐
     - **마스터 계정: 드롭다운 하단 '항목 관리' 버튼** 👑
   - **재방문 관리** 🎯
     - 1차~5차 순차적 활성화 (이전 차수 완료 시 다음 차수 활성화)
     - 각 차수별 유상/무상 선택
     - 유상 선택 시 비용 입력 및 입금상태 관리
     - 입금상태: 입금대기, 입금완료, 입금거부
     - 입금거부 시 비고 필수 (한글 2글자 이상)
   - **운영 이관** 🎯
     - 설치완료 건 조회
     - 일괄 선택하여 운영등재로 이관
     - 성공/실패 건수 표시
   - **이전 기록 검색** 🎯
     - 설치완료/취소 건 검색
     - 상태 필터링 (전체/완료/취소)
     - 검색 결과 테이블 표시
   - **모드 전환**: 리스트 ↔ 칸반 버튼으로 전환

7. **항목 관리 시스템** ⭐ NEW
   - **관리자 메뉴 > 항목 관리** 페이지
   - **카테고리별 탭**:
     - 상담현황 (유입경로, 상담목적, 상담경로)
     - 계약현황 (계약유형)
     - 설치현황 (설치유형)
     - 공통 (부서, 직책)
   - **CRUD 기능** (마스터/관리자만):
     - 항목 추가: 값, 표시 이름, 정렬 순서
     - 항목 수정: 모든 필드 수정 가능
     - 항목 삭제: 비활성화 처리 (데이터 보존)
     - 정렬 순서 조정
   - **API 연동**:
     - `GET /api/items/categories` - 카테고리 목록
     - `GET /api/items/categories/:id/values` - 항목 조회 (ID)
     - `GET /api/items/values/:categoryName` - 항목 조회 (이름, 드롭다운용)
     - `POST /api/items/values` - 항목 추가
     - `PUT /api/items/values/:id` - 항목 수정
     - `DELETE /api/items/values/:id` - 항목 삭제
   - **드롭다운 통합**:
     - 모든 드롭다운이 항목 관리 API와 연동
     - 마스터 계정: 드롭다운 하단에 '항목 관리' 버튼 표시
     - 버튼 클릭 시 항목 관리 페이지로 이동
     - 해당 카테고리 탭 자동 선택
   - **초기 데이터** (37개 항목):
     - 유입경로 7개 (기존 고객, 네이버 검색, 구글 검색, 지인 추천, 전화 문의, 홈페이지, 기타)
     - 상담목적 5개 (신규 계약, 계약 갱신, 문의사항, 불만사항, 기타)
     - 상담경로 5개 (전화, 이메일, 방문, 온라인, 기타)
     - 계약유형 4개 (신규, 갱신, 업그레이드, 다운그레이드)
     - 설치유형 4개 (신규 설치, 교체 설치, 이전 설치, 추가 설치)
     - 직책 12개 (사원 ~ 대표이사)

8. **사용자 관리** ⭐
   - **사용자 목록**:
     - 테이블 형태로 전체 사용자 조회
     - **컬럼 정렬 기능** (ID, 아이디, 이름, 닉네임, 부서, 직책, 권한, 가입일)
     - 행별 수정/삭제 버튼
   - **신규 사용자 추가**:
     - 아이디, 비밀번호, 이름, 닉네임, 연락처
     - **부서 선택 (17개 부서)** ⭐
     - 직책, 권한 (master/admin/user)
   - **부서 목록** (17개):
     - 디지털사업본부, 마케팅팀, 디지털사업팀, 운영파트
     - 대표이사, 수석부사장, 디지털프로덕트본부, 개발팀
     - 디지털기획팀, QA팀, UIUX디자인파트
     - 경영지원그룹, 법무파트, 재무회계파트, 인사파트, 총무파트

9. **좌측 메뉴바**
   - 사용자 정보 표시
   - 홈/앞으로/뒤로 네비게이션 버튼
   - 권한 기반 메뉴 표시
   - 서브메뉴 지원 (접기/펼치기)
   - 사이드바 토글 (축소/확장)

10. **메뉴 구성**
   - 공지사항 ✅
   - 상담현황 ✅
   - 계약현황 ✅
   - 설치현황 ✅
   - 운영등재
   - 가맹점현황
   - 정산관리 (서브메뉴: CMS/CRM/Ai매출업/대시보드)
   - 재고관리 (서브메뉴: 현황/요청/반납/대여/대시보드)
   - CS관리 (서브메뉴: 인바운드/방문A/S/H/W QA)
   - **관리자 메뉴** (서브메뉴: 사용자/로케이션/페이지/**항목**/품목 관리) ⭐

11. **권한 시스템**
   - 역할 기반 접근 제어 (master, admin, user)
   - 메뉴별 권한 설정
   - 관리자 메뉴는 master/admin만 접근
   - **항목 관리 권한**: master/admin (조회/추가/수정), master만 (삭제)

### 🚧 준비 중인 기능
- 운영등재 페이지
- 가맹점현황 페이지
- 정산 전용 디자인
- 재고 대시보드
- 로케이션/페이지/품목 관리

## 사용자 가이드

### 로그인
1. 브라우저에서 https://monki-biz-op.pages.dev 접속
2. 마스터 계정 정보 입력 (master / Master1234!)
3. 로그인 버튼 클릭

### 항목 관리 사용법 ⭐
1. **항목 관리 페이지 접속**:
   - 좌측 메뉴 → 관리자 메뉴 → 항목 관리
   - 또는 드롭다운 하단의 '항목 관리' 버튼 클릭 (마스터만)

2. **카테고리 선택**:
   - 상단 탭에서 원하는 카테고리 선택
   - 상담현황, 계약현황, 설치현황, 공통

3. **항목 추가**:
   - '항목 추가' 버튼 클릭
   - 값 (영문, 시스템 내부용)
   - 표시 이름 (한글, 사용자에게 보이는 이름)
   - 정렬 순서 (숫자, 작을수록 위에 표시)

4. **항목 수정**:
   - 연필 아이콘 클릭
   - 표시 이름, 정렬 순서 수정
   - 활성화/비활성화 토글

5. **항목 삭제**:
   - 휴지통 아이콘 클릭 (마스터만)
   - 실제 삭제 아닌 비활성화 처리
   - 데이터는 보존되며 드롭다운에서만 숨겨짐

### 대시보드 사용
1. 로그인 후 자동으로 대시보드로 이동
2. 4개의 현황 카드에서 각 업무 진행 상황 확인
3. 카드 클릭 시 상세 페이지로 이동

### 메뉴 탐색
1. 좌측 사이드바에서 원하는 메뉴 선택
2. 서브메뉴가 있는 경우 클릭하여 펼치기/접기
3. 사이드바 상단의 햄버거 버튼으로 축소/확장 가능

### 네비게이션
- **홈 버튼**: 대시보드로 돌아가기
- **뒤로 버튼**: 이전 페이지로
- **앞으로 버튼**: 다음 페이지로

### 로그아웃
- 좌측 하단 또는 우측 상단의 로그아웃 버튼 클릭
- 확인 후 로그인 페이지로 이동

### 프로필 수정
- 우측 상단 사용자 이름 클릭
- 이름, 닉네임, 연락처, 부서명, 직책 수정 가능
- 비밀번호 변경 가능 (선택)

## 배포

### 로컬 개발
```bash
# 빌드
npm run build

# 데이터베이스 마이그레이션 (로컬)
npm run db:migrate:local

# 데이터베이스 마이그레이션 (프로덕션)
npm run db:migrate:prod

# 개발 서버 시작 (PM2)
pm2 start ecosystem.config.cjs

# 서버 확인
curl http://localhost:3000
```

### Cloudflare Pages 배포
```bash
# Cloudflare 인증 설정 필요
# API 키 설정 후 배포
npm run deploy:prod
```

### 플랫폼
- **플랫폼**: Cloudflare Pages + Workers
- **상태**: ✅ 프로덕션 배포 완료
- **URL**: https://monki-biz-op.pages.dev
- **기술 스택**: 
  - Backend: Hono + TypeScript
  - Frontend: Vanilla JS + TailwindCSS
  - Database: Cloudflare D1 (SQLite)
  - 인증: bcrypt + Session Cookie
- **마지막 업데이트**: 2026-01-30
  
## 최근 업데이트 내역
- **2026-01-30**: 
  - ✅ **항목 관리 시스템 완전 구현** ⭐
    - item_categories, item_values 테이블 생성
    - 7개 카테고리, 37개 초기 항목 등록
    - RESTful API 구현 (GET/POST/PUT/DELETE)
    - 항목 관리 UI 페이지 (탭, 목록, CRUD 모달)
    - 드롭다운 API 연동 (상담/계약/설치)
    - 마스터 계정: 드롭다운 하단 '항목 관리' 버튼
  - ✅ 사용자 관리 테이블 정렬 기능 수정
  - ✅ 부서 17개 추가 (대표이사 ~ 총무파트)
  - ✅ 마스터 계정 추가 (master / Master1234!)
  - ✅ D1 바인딩 설정 및 Cloudflare Pages 배포

- **2026-01-29**: 
  - ✅ 설치현황 칸반 보드 및 리스트 정렬 기능 완료
  - ✅ 재방문 관리 시스템 (1~5차, 입금상태 관리) 완료
  - ✅ 운영 이관 기능 완료
  - ✅ 이전 기록 검색 기능 완료
  - ✅ 상담현황/계약현황 테이블 정렬 기능 추가
  - ✅ 로그아웃 버튼 작동 수정 (좌측 하단 + 우측 상단)
  - ✅ 로그인 페이지 문구 변경 (디지털사업본부)
  - ✅ 프로필 수정 기능 완전 구현
  - ✅ 좌측 메뉴 디자인 고급화 (그라데이션, 그림자, 색상 개선)

## 개발 정보

### 프로젝트 구조
```
/home/user/webapp/
├── src/
│   ├── index.tsx           # 메인 애플리케이션
│   ├── types.ts            # TypeScript 타입 정의
│   ├── lib/
│   │   └── auth.ts         # 인증 유틸리티
│   ├── middleware/
│   │   └── auth.ts         # 인증 미들웨어
│   └── routes/
│       ├── auth.ts         # 인증 API
│       ├── notices.ts      # 공지사항 API
│       ├── consultations.ts # 상담현황 API
│       ├── contracts.ts    # 계약현황 API
│       ├── installations.ts # 설치현황 API
│       ├── operations.ts   # 운영등재 API
│       ├── users.ts        # 사용자 관리 API
│       ├── departments.ts  # 부서 API
│       └── items.ts        # 항목 관리 API ⭐
├── public/static/
│   ├── app.js              # 메인 JavaScript
│   ├── login.js            # 로그인 JavaScript
│   ├── dropdown-helper.js  # 드롭다운 헬퍼 ⭐
│   ├── table-sort.js       # 테이블 정렬
│   ├── consultation.js     # 상담현황
│   ├── contract.js         # 계약현황
│   ├── installation.js     # 설치현황
│   ├── user-management.js  # 사용자 관리
│   └── item-management.js  # 항목 관리 ⭐
├── migrations/
│   ├── 0001_initial_schema.sql
│   ├── ...
│   ├── 0018_recreate_item_tables.sql  # 항목 관리 테이블
│   └── 0019_seed_item_data.sql        # 초기 항목 데이터
├── ecosystem.config.cjs    # PM2 설정
├── wrangler.jsonc          # Cloudflare 설정
└── package.json
```

### API 엔드포인트

#### 인증
- `POST /api/auth/login` - 로그인
- `POST /api/auth/logout` - 로그아웃
- `GET /api/auth/me` - 현재 사용자 정보

#### 항목 관리 ⭐ NEW
- `GET /api/items/categories` - 카테고리 목록 (페이지별 필터)
- `GET /api/items/categories/:id/values` - 특정 카테고리의 항목 조회
- `GET /api/items/values/:categoryName` - 카테고리명으로 항목 조회 (드롭다운용)
- `POST /api/items/values` - 항목 추가 (마스터/관리자)
- `PUT /api/items/values/:id` - 항목 수정 (마스터/관리자)
- `DELETE /api/items/values/:id` - 항목 삭제/비활성화 (마스터만)

#### 공지사항
- `GET /api/notices` - 공지사항 목록
- `GET /api/notices/:id` - 공지사항 상세
- `POST /api/notices` - 공지사항 작성
- `PUT /api/notices/:id` - 공지사항 수정
- `DELETE /api/notices/:id` - 공지사항 삭제

#### 상담현황
- `GET /api/consultations` - 상담 목록 (페이징, 상태 필터링)
- `GET /api/consultations/:id` - 상담 상세
- `POST /api/consultations` - 상담 등록
- `PUT /api/consultations/:id` - 상담 수정
- `PUT /api/consultations/:id/status` - 상태 변경 (드래그앤드롭용)
- `DELETE /api/consultations/:id` - 상담 삭제

#### 계약현황
- `GET /api/contracts` - 계약 목록 (페이징, 상태 필터링)
- `GET /api/contracts/:id` - 계약 상세
- `POST /api/contracts` - 계약 등록
- `PUT /api/contracts/:id` - 계약 수정
- `PUT /api/contracts/:id/status` - 상태 변경 (드래그앤드롭용)
- `DELETE /api/contracts/:id` - 계약 삭제
- `POST /api/contracts/migrate-to-installation` - 설치 이관

#### 설치현황
- `GET /api/installations` - 설치 목록 (페이징, 상태 필터링, 이전 기록 검색)
- `GET /api/installations/:id` - 설치 상세
- `POST /api/installations` - 설치 등록
- `PUT /api/installations/:id` - 설치 수정 (재방문 정보 포함)
- `PUT /api/installations/:id/status` - 상태 변경 (드래그앤드롭용)
- `DELETE /api/installations/:id` - 설치 삭제
- `GET /api/installations/stats/completed` - 설치완료 건수 조회
- `POST /api/installations/migrate-to-operation` - 운영 이관

#### 부서
- `GET /api/departments` - 부서 목록 (17개)

#### 사용자 관리
- `GET /api/users` - 사용자 목록
- `GET /api/users/:id` - 사용자 상세
- `POST /api/users` - 사용자 추가
- `PUT /api/users/:id` - 사용자 수정
- `DELETE /api/users/:id` - 사용자 삭제

## 다음 개발 단계
1. ~~공지사항 게시판 구현~~ ✅
2. ~~상담현황 페이지 (리스트/칸반 뷰 + 드래그앤드롭)~~ ✅
3. ~~계약현황 페이지 (리스트/칸반 뷰 + 드래그앤드롭 + 설치 이관)~~ ✅
4. ~~설치현황 페이지 (리스트/칸반 뷰 + 재방문 관리 + 운영 이관)~~ ✅
5. ~~테이블 정렬 기능 (상담/계약/설치 리스트 모드)~~ ✅
6. ~~사용자 관리 페이지~~ ✅
7. ~~부서 관리~~ ✅
8. ~~항목 관리 시스템 (드롭다운 통합 관리)~~ ✅
9. 운영등재 페이지
10. 가맹점현황 테이블
11. 정산관리 페이지들
12. 재고관리 시스템
13. CS관리 시스템
14. 로케이션/페이지/품목 관리
