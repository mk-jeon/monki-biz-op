# MONKi Biz Operation

## 프로젝트 개요
- **이름**: MONKi Biz Operation
- **정식 명칭**: 사업운영본부 통합 업무 플랫폼
- **목표**: 통합 업무 플랫폼 구축
- **주요 기능**: 
  - 사용자 인증 및 권한 관리
  - 대시보드 (상담현황, 계약현황, 설치현황, 운영등재)
  - 공지사항 게시판
  - 권한 기반 메뉴 시스템
  - 반응형 UI/UX

## URLs
- **개발 서버**: https://3000-ikweelui4r2y3zoxxkatc-d0b9e1e2.sandbox.novita.ai
- **GitHub**: https://github.com/mk-jeon/monki-biz-op

## 로그인 정보
### 마스터 계정
- **아이디**: minhiti88
- **비밀번호**: Axieslin12!
- **권한**: 모든 권한 (master)

## 데이터 아키텍처
- **데이터 모델**:
  - Users (사용자)
  - Sessions (세션)
  - Permissions (권한)
- **스토리지 서비스**: Cloudflare D1 (SQLite)
- **인증 방식**: 세션 기반 인증 (쿠키)

## 현재 구현된 기능

### ✅ 완료된 기능
1. **로그인 시스템**
   - 사용자 인증 (아이디/비밀번호)
   - 세션 관리 (24시간 유지)
   - 로그아웃 기능

2. **대시보드**
   - 4개 주요 현황 카드 (상담/계약/설치/운영)
   - **실시간 진행 건수 표시** (API 연동)
   - 상담현황 건수 자동 로드
   - 카드 클릭 시 상세 페이지 이동

3. **공지사항 게시판** ✅
   - 목록 조회 (페이지네이션)
   - **분류 기능** (업데이트/정보공유/일반)
   - **중요 공지 표시**
   - **연관채널 다중 선택** (사장님사이트, 테이블오더App, OKPOS, EasyPOS, 엑스퍼트포스, 유니온)
   - 상단 고정 기능
   - 작성/수정/삭제 (권한 기반)
   - 조회수 표시
   - 내용 미리보기
   - 반응형 에디터
   - **채널별 색상 뱃지**

4. **상담현황** ⭐
   - **리스트 모드**
     - 테이블 형태로 전체 상담 목록 조회
     - **컬럼 정렬 기능** (헤더 클릭 시 오름차순 → 내림차순 → 기본순)
     - 정렬 가능: ID, 상태, 고객명, 전화번호, 유입경로, 등록일, 등록자
     - 기본 정렬: 상태 우선순위 + 최신순
     - 행 클릭 시 상세 모달
     - 수정/삭제 버튼
   - **칸반 모드** 🎯
     - 5개 컬럼: 상담대기 / 상담중 / 보류 / 계약확정 / 취소
     - **드래그앤드롭으로 상태 변경**
     - 카드 형태로 주요 정보 표시
     - 드롭존 시각적 피드백
     - 각 컬럼별 건수 표시
   - **신규 등록**
     - 고객명 (선택), 전화번호 (필수)
     - 유입경로 (드롭다운 - 항목관리에서 관리)
     - 요청사항/메모 (넓은 텍스트 영역)
     - 진행 상태 선택 (수정 시)
     - 세부 옵션: 방문상담 O/X, 견적서 O/X
   - **엑셀 기능**
     - 빈양식 다운로드 (CSV)
     - 일괄 업로드 (성공/실패 건수 표시)
   - **모드 전환**: 리스트 ↔ 칸반 버튼으로 전환

5. **계약현황** ⭐
   - **리스트 모드**
     - 테이블 형태로 전체 계약 목록 조회
     - **컬럼 정렬 기능** (헤더 클릭 시 오름차순 → 내림차순 → 기본순)
     - 정렬 가능: ID, 상태, 고객명, 전화번호, 유입경로, 등록일, 등록자
     - 기본 정렬: 상태 우선순위 + 최신순
     - 행 클릭 시 상세 모달
     - 수정/삭제 버튼
   - **칸반 모드** 🎯
     - 6개 컬럼: 계약대기 / 계약 중 / 서명대기 / 계약보류 / 계약완료 / 취소
     - **드래그앤드롭으로 상태 변경**
     - 카드 형태로 주요 정보 표시 (선설치 배지 포함)
     - 드롭존 시각적 피드백
     - 각 컬럼별 건수 표시
   - **신규 등록**
     - 고객명 (선택), 전화번호 (필수)
     - 유입경로, 진행 상태
     - 세부 옵션: 선 설치진행 O/X
     - 메모
   - **모드 전환**: 리스트 ↔ 칸반 버튼으로 전환
   - **설치 이관**: 계약완료 건을 설치현황으로 이관

6. **설치현황** ⭐ NEW
   - **리스트 모드**
     - 테이블 형태로 전체 설치 목록 조회
     - **컬럼 정렬 기능** (헤더 클릭 시 오름차순 → 내림차순 → 기본순)
     - 정렬 가능: ID, 상태, 고객명, 전화번호, 등록일, 등록자
     - 기본 정렬: 상태 우선순위 + 최신순
     - 플래그 표시: 계약서 미진행
     - 체크리스트 아이콘: 설치확인서, 설치사진, 드라이브 업로드
     - 행 클릭 시 상세 모달
     - 수정/삭제 버튼
   - **칸반 모드** 🎯
     - 5개 컬럼: 설치대기 / 설치 중 / 설치보류 / 설치완료 / 설치취소
     - **드래그앤드롭으로 상태 변경**
     - 카드 형태로 주요 정보 표시
     - 선설치 배지, 체크리스트 아이콘, 재방문 정보
     - 각 컬럼별 건수 표시
   - **재방문 관리** 🎯
     - 1차~5차 순차적 활성화 (이전 차수 완료 시 다음 차수 활성화)
     - 각 차수별 유상/무상 선택
     - 유상 선택 시 비용 입력 및 입금상태 관리
     - 입금상태: 입금대기, 입금완료, 입금거부
     - 입금거부 시 비고 필수 (한글 2글자 이상)
   - **운영 이관** 🎯
     - 설치완료 건 조회
     - 일괄 선택하여 운영등재로 이관
     - 성공/실패 건수 표시
   - **이전 기록 검색** 🎯
     - 설치완료/취소 건 검색
     - 상태 필터링 (전체/완료/취소)
     - 검색 결과 테이블 표시
   - **모드 전환**: 리스트 ↔ 칸반 버튼으로 전환

7. **좌측 메뉴바**
   - 사용자 정보 표시
   - 홈/앞으로/뒤로 네비게이션 버튼
   - 권한 기반 메뉴 표시
   - 서브메뉴 지원 (접기/펼치기)
   - 사이드바 토글 (축소/확장)

8. **메뉴 구성**
   - 공지사항 ✅
   - 상담현황 ✅
   - 계약현황 ✅
   - 설치현황 ✅
   - 운영등재
   - 가맹점현황
   - 정산관리 (서브메뉴: CMS/CRM/Ai매출업/대시보드)
   - 재고관리 (서브메뉴: 현황/요청/반납/대여/대시보드)
   - CS관리 (서브메뉴: 인바운드/방문A/S/H/W QA)
   - 관리자 메뉴 (서브메뉴: 사용자/로케이션/페이지/항목/품목 관리)

9. **권한 시스템**
   - 역할 기반 접근 제어 (master, admin, user)
   - 메뉴별 권한 설정
   - 관리자 메뉴는 master/admin만 접근

### 🚧 준비 중인 기능
- 운영등재 페이지
- 가맹점현황 페이지
- 정산 전용 디자인
- 재고 대시보드
- 사용자 관리 페이지 (프로필 수정 포함)
- 로케이션/페이지/항목/품목 관리
- 좌측 메뉴 디자인 고도화
- 로그인 페이지 문구 업데이트

## 사용자 가이드

### 로그인
1. 브라우저에서 https://3000-ikweelui4r2y3zoxxkatc-d0b9e1e2.sandbox.novita.ai 접속
2. 마스터 계정 정보 입력 (minhiti88 / Axieslin12!)
3. 로그인 버튼 클릭

### 대시보드 사용
1. 로그인 후 자동으로 대시보드로 이동
2. 4개의 현황 카드에서 각 업무 진행 상황 확인
3. 카드 클릭 시 상세 페이지로 이동 (준비중)

### 메뉴 탐색
1. 좌측 사이드바에서 원하는 메뉴 선택
2. 서브메뉴가 있는 경우 클릭하여 펼치기/접기
3. 사이드바 상단의 햄버거 버튼으로 축소/확장 가능

### 네비게이션
- **홈 버튼**: 대시보드로 돌아가기
- **뒤로 버튼**: 이전 페이지로
- **앞으로 버튼**: 다음 페이지로

### 로그아웃
- 좌측 하단의 로그아웃 버튼 클릭
- 확인 후 로그인 페이지로 이동

## 배포

### 로컬 개발
```bash
# 빌드
npm run build

# 데이터베이스 마이그레이션
npm run db:migrate:local

# 개발 서버 시작 (PM2)
pm2 start ecosystem.config.cjs

# 서버 확인
curl http://localhost:3000
```

### Cloudflare Pages 배포
```bash
# Cloudflare 인증 설정 필요
# API 키 설정 후 배포
npm run deploy:prod
```

### 플랫폼
- **플랫폼**: Cloudflare Pages + Workers
- **상태**: ✅ 개발 서버 실행 중
- **기술 스택**: 
  - Backend: Hono + TypeScript
  - Frontend: Vanilla JS + TailwindCSS
  - Database: Cloudflare D1 (SQLite)
  - 인증: bcrypt + Session Cookie
- **마지막 업데이트**: 2026-01-29
  
## 최근 업데이트 내역
- **2026-01-29**: 
  - 설치현황 칸반 보드 및 리스트 정렬 기능 완료
  - 재방문 관리 시스템 (1~5차, 입금상태 관리) 완료
  - 운영 이관 기능 완료
  - 이전 기록 검색 기능 완료
  - 상담현황/계약현황 테이블 정렬 기능 추가

## 개발 정보

### 프로젝트 구조
```
/home/user/webapp/
├── src/
│   ├── index.tsx           # 메인 애플리케이션
│   ├── types.ts            # TypeScript 타입 정의
│   ├── lib/
│   │   └── auth.ts         # 인증 유틸리티
│   ├── middleware/
│   │   └── auth.ts         # 인증 미들웨어
│   └── routes/
│       └── auth.ts         # 인증 API 라우트
├── public/static/
│   ├── app.js              # 대시보드 JavaScript
│   └── login.js            # 로그인 JavaScript
├── migrations/
│   └── 0001_initial_schema.sql  # 데이터베이스 스키마
├── ecosystem.config.cjs    # PM2 설정
├── wrangler.jsonc          # Cloudflare 설정
└── package.json
```

### API 엔드포인트

#### 인증
- `POST /api/auth/login` - 로그인
- `POST /api/auth/logout` - 로그아웃
- `GET /api/auth/me` - 현재 사용자 정보

#### 공지사항
- `GET /api/notices` - 공지사항 목록
- `GET /api/notices/:id` - 공지사항 상세
- `POST /api/notices` - 공지사항 작성
- `PUT /api/notices/:id` - 공지사항 수정
- `DELETE /api/notices/:id` - 공지사항 삭제

#### 계약현황
- `GET /api/contracts` - 계약 목록 (페이징, 상태 필터링)
- `GET /api/contracts/:id` - 계약 상세
- `POST /api/contracts` - 계약 등록
- `PUT /api/contracts/:id` - 계약 수정
- `PUT /api/contracts/:id/status` - 상태 변경 (드래그앤드롭용)
- `DELETE /api/contracts/:id` - 계약 삭제
- `POST /api/contracts/migrate-to-installation` - 설치 이관

#### 설치현황
- `GET /api/installations` - 설치 목록 (페이징, 상태 필터링, 이전 기록 검색)
- `GET /api/installations/:id` - 설치 상세
- `POST /api/installations` - 설치 등록
- `PUT /api/installations/:id` - 설치 수정 (재방문 정보 포함)
- `PUT /api/installations/:id/status` - 상태 변경 (드래그앤드롭용)
- `DELETE /api/installations/:id` - 설치 삭제
- `GET /api/installations/stats/completed` - 설치완료 건수 조회
- `POST /api/installations/migrate-to-operation` - 운영 이관

## 다음 개발 단계
1. ~~공지사항 게시판 구현~~ ✅
2. ~~상담현황 페이지 (리스트/칸반 뷰 + 드래그앤드롭)~~ ✅
3. ~~계약현황 페이지 (리스트/칸반 뷰 + 드래그앤드롭 + 설치 이관)~~ ✅
4. ~~설치현황 페이지 (리스트/칸반 뷰 + 재방문 관리 + 운영 이관)~~ ✅
5. ~~테이블 정렬 기능 (상담/계약/설치 리스트 모드)~~ ✅
6. 운영등재 페이지
7. 프로필 수정 기능 (이름, 비밀번호, 연락처, 부서, 직책)
8. 로그아웃 버튼 수정
9. 좌측 메뉴 디자인 고도화
10. 로그인 페이지 문구 업데이트
11. 가맹점현황 테이블
12. 정산관리 페이지들
13. 재고관리 시스템
14. CS관리 시스템
15. 관리자 페이지들
